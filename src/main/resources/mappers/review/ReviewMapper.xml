<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ReviewMapper">

<resultMap type="com.bitcamp.sc.review.domain.ReviewVO" id="ReviewDomain">
	<result property="idx" column="id"/>
	<result property="title" column="title"/>
	<result property="name" column="name"/>
	<result property="contents" column="contents"/>
	<result property="rate" column="rate"/>
	<result property="date" column="date"/>
	<result property="likes" column="rlikes"/>
	<result property="viewcnt" column="viewcnt"/>
	<result property="gphoto" column="photo"/>
	<result property="pidx" column="pidx"/>
</resultMap>


    <!-- 01. 게시글 작성 -->
    <insert id="insertReview"
		parameterType="com.bitcamp.sc.review.domain.ReviewVO"
		useGeneratedKeys="true"
		keyProperty="idx"
	>
        INSERT INTO review 
        (
	         title
	        , contents
	        , name
	        , pidx
        ) 
        VALUES 
        (
	         #{title}
	        , #{contents}
	        , #{name}
	        , #{oidx}
        )
	</insert>

	<!--02. 게시글 상세보기 조회 -->
	<select id="readReview"  resultMap="ReviewDomain" parameterType="Integer" >
		SELECT
			id
        	, title
        	, name
        	, contents
        	, rate
        	, date_format(date,'%Y-%m-%d') as rdate
            , rlikes
            , pidx
		FROM
			review
		WHERE
			id = #{idx}
	</select>
	
	<!-- 03. 게시글 수정처리 -->
	<update id="updateReview" parameterType="com.bitcamp.sc.review.domain.ReviewVO" >
		UPDATE 
			review 
		SET 
			title = #{title}
			, contents = #{contents}
		WHERE 
			id = #{idx}
	</update>
    
	<!-- 04. 게시글 삭제처리 -->
	<delete id="deleteReview"  parameterType="Integer" >
		DELETE 
		FROM 
			review 
		WHERE 
			id = #{idx}
	</delete>
	

    <!-- 05. 게시글 전체 목록 조회 -->
    <select id="listAllReview"  resultMap="ReviewDomain" >
        SELECT 
			id
			, title
			, name
			, contents
			, rate
			, DATE_FORMAT(date,'%Y-%m-%d') AS rdate
			, rlikes
			, A.pidx
		FROM
			review A
		ORDER BY
			id DESC, rdate DESC
    </select>
    
    
<!--     06-1. 게시글 좋아요 증가 처리
	<update id="likeReview" parameterType="com.bitcamp.sc.review.domain.ReviewVO" >
		UPDATE 
			review 
		SET 
			rlikes = #{likes} + 1
		WHERE 
			ridx = #{idx}
	</update>
	
	06-2. 게시글 좋아요 감소 처리
	<update id="likeReview" parameterType="com.bitcamp.sc.review.domain.ReviewVO" >
		UPDATE 
			review 
		SET 
			rlikes = #{likes} - 1
		WHERE 
			ridx = #{idx}
	</update> -->
    
    
    
<!--	// 07. 게시글 조회수 증가처리
	<update id="increaseViewcnt">
		UPDATE review SET viewcnt = viewcnt + 1 WHERE ridx = #{idx}
	</update>
-->
	
</mapper>
